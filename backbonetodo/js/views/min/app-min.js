define(["jquery","underscore","backbone","collections/todos","views/todos","text!templates/stats.html","common"],function($,t,e,i,l,o,n){"use strict";var s=e.View.extend({el:"#todoapp",template:t.template(o),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#new-todo"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.$todoList=this.$("#todo-list"),this.listenTo(i,"add",this.addOne),this.listenTo(i,"reset",this.addAll),this.listenTo(i,"change:completed",this.filterOne),this.listenTo(i,"filter",this.filterAll),this.listenTo(i,"all",this.render),i.fetch({reset:!0})},render:function(){var t=i.completed().length,e=i.remaining().length;i.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.template({completed:t,remaining:e})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(n.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!e},addOne:function(t){var e=new l({model:t});this.$todoList.append(e.render().el)},addAll:function(){this.$todoList.empty(),i.each(this.addOne,this)},filterOne:function(t){t.trigger("visible")},filterAll:function(){i.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:i.nextOrder(),completed:!1}},createOnEnter:function(t){t.which===n.ENTER_KEY&&this.$input.val().trim()&&(i.create(this.newAttributes()),this.$input.val(""))},clearCompleted:function(){return t.invoke(i.completed(),"destroy"),!1},toggleAllComplete:function(){var t=this.allCheckbox.checked;i.each(function(e){e.save({completed:t})})}});return s});